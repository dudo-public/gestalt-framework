# インポートガイドライン

## 概要
様々な形式のファイルをObsidian VaultのAtomに変換する際の統合ガイドラインです。

## 対応形式別ガイドライン

### HTMLファイルのインポート

#### 基本原則
1. HTMLファイルに含まれる画像等のメディアファイルは、Obsidianの標準的な添付ファイル管理に従う
2. メディアファイルの配置とリンクは、Obsidianで正しく表示されるよう処理する
3. 元の文書構造と画像の文脈的な関係性を維持する

#### 重要: 画像を含むHTMLの処理手順
1. **事前処理**: トークン制限を回避するため、画像を先に処理
   ```bash
   # 1. 画像ファイルの特定
   ls -la "00_RAW/ディレクトリ名/images/"
   
   # 2. 各画像のハッシュ生成
   md5 -q image1.png
   
   # 3. _attachmentsへの移動
   cp "images/image1.png" "_attachments/prefix_hash_image1.png"
   ```

2. **HTMLの読み込み**: 画像移動後、テキストのみを処理
   ```bash
   # mcp__obsidian__fetchで変換
   url: file:///path/to/file.html
   maxLength: 10000  # トークン制限対策
   ```

#### mcp__obsidian__fetchの使用方法
1. **URLフォーマット**:
   - プロトコル: `file://`
   - スペース: `%20`にエンコード
   - 例: `file:///Users/yuki/Workspace/obsidian/Obsidian%20Workspace%20Vault/00_RAW/...`

2. **大きなファイルの処理**:
   ```yaml
   # 分割取得
   maxLength: 10000
   startIndex: 0      # 1回目
   startIndex: 10000  # 2回目
   startIndex: 20000  # 3回目
   ```

#### トラブルシューティング
1. **トークン制限エラー**: 
   - 画像が含まれていないか確認
   - maxLengthを使用して分割取得

2. **404エラー**:
   - URLエンコーディングを確認
   - ファイルパスの存在確認

#### 実装手順

##### 1. メディアファイルの移動
```bash
# 例：RAWディレクトリのHTMLファイルに関連する画像
# 元: 00_RAW/ディレクトリ名/images/image1.png
# 先: _attachments/プレフィックス_ハッシュ_image1.png
```

1. ファイル名の重複を避けるため、以下の形式で名前を生成：
   - `プレフィックス`: 内容を識別する短い名前（例：lead_platform, ai_avatar）
   - `ハッシュ`: ファイルのMD5ハッシュの最初の8文字
   - 元のファイル名を保持
2. 関連するすべてのメディアファイルを`_attachments`ディレクトリにコピー
3. どの画像がどの文脈で使われているか、HTMLを解析して記録

##### 2. Obsidianリンク形式への変換
```markdown
# HTML形式
<img src="images/image1.png" alt="説明文">

# Obsidianリンク形式（推奨）
![[プレフィックス_ハッシュ_image1.png|説明文]]
```

##### 3. 画像の文脈維持
- 画像の前後に適切な説明文を配置
- 画像のキャプションや代替テキストを保持
- 図表番号がある場合は維持

---

### PDFファイルのインポート

#### 基本方針
1. PDFファイル自体は`_attachments`に保存（原本保持）
2. 内容はMarkdownに変換してAtomとして管理
3. 画像やグラフは抽出して適切にリンク
4. メタデータで元PDFへの参照を維持

#### 推奨ツール
- **Obsidianプラグイン「pdf-mistral」**: PDFからMarkdownへの自動変換
- **代替手段**: `pdftotext`（テキスト抽出）、`pdfimages`（画像抽出）

#### 実装手順

##### 1. PDFファイルの配置
```bash
# 元: 00_RAW/ファイル名.pdf
# 先: _attachments/プレフィックス_ハッシュ_ファイル名.pdf
```

##### 2. 内容の抽出と変換（ユーザーとの協力プロセス）

**AIアシスタントからユーザーへの依頼フォーマット：**
```
PDFのAtom化のため以下の方法でmdファイルに変更をお願いします。

1. Command Paletteを開く（Cmd/Ctrl + P）
2. "Convert PDF to Markdown with images" を選択
3. 変換したいPDF（00_RAW/[ファイル名].pdf）を選択
4. Markdownファイルが元のPDFと同じファイル名で00_RAW/に出力されます

変換が完了したらお知らせください。
```

**ユーザーからの完了報告後：**
- AIアシスタントは00_RAWディレクトリを確認
- PDFファイルとMDファイルの両方の存在を確認
- MDファイルのAtom化を実行

##### 3. Atomの作成
```markdown
---
id: id_20250616_document_title
title: ドキュメントタイトル
type: document
status: processed
attachments:
  - ![[プレフィックス_ハッシュ_original.pdf|元PDF]]
---

# ドキュメントタイトル

> 元ファイル: ![[プレフィックス_ハッシュ_original.pdf|元PDF参照]]

[変換された内容]
```

---

## 共通チェックリスト

### HTMLインポート時
- [ ] 関連メディアファイルをすべて特定
- [ ] `_attachments`ディレクトリに適切に配置
- [ ] すべての画像リンクをObsidian形式に変換
- [ ] 画像の説明文や文脈を維持
- [ ] Obsidianで実際に表示確認

### PDFインポート時
- [ ] テキストが正しく抽出されているか
- [ ] 文字化けや欠落がないか
- [ ] 画像・図表が適切に配置されているか
- [ ] 元PDFへのリンクが機能するか
- [ ] メタデータが適切に設定されているか

## ファイル命名規則

### 基本形式
```
プレフィックス_ハッシュ_元のファイル名.拡張子
```

### プレフィックスの例
- `lead_platform`: リード生成プラットフォーム関連
- `ai_interview`: AI面接システム関連
- `company_doc`: 会社文書
- `tech_report`: 技術レポート

### ハッシュの生成
```bash
# MD5ハッシュの最初の8文字を使用
md5 -q filename | cut -c1-8
```

### ZIPファイルのインポート

#### 基本方針
1. ZIPファイルは00_RAW内で展開し、拡張子を除いた同名のディレクトリを作成
2. 展開されたファイルの形式に応じて、適切なインポート手順を適用
3. 元のZIPファイルは処理後も保持（アーカイブとして）

#### 実装手順

##### 1. ZIPファイルの展開
```bash
# 00_RAWディレクトリ内で実行
cd "/path/to/00_RAW"
unzip -o "ファイル名.zip" -d "ファイル名"
```

例：
```bash
# 【AI面接システム】SpeechToTextの結果.zip の場合
unzip -o "【AI面接システム】SpeechToTextの結果.zip" -d "【AI面接システム】SpeechToTextの結果"
```

##### 2. 展開内容の確認と分類
展開されたファイルを確認し、含まれるファイル形式に応じて処理を決定：
- **HTMLファイル + 画像**: HTMLインポートガイドラインに従う
- **PDFファイル**: PDFインポートガイドラインに従う
- **Markdownファイル**: そのままAtom化処理へ
- **その他の形式**: 形式に応じた変換を検討

##### 3. 各形式に応じた処理の実行
1. メディアファイルのハッシュ生成と配置
2. 適切な形式への変換（HTML→Markdown等）
3. Obsidianリンク形式への変換
4. Atom化の準備

##### 4. 処理後の構造
```
00_RAW/
├── ファイル名.zip              # 元のZIPファイル（保持）
├── ファイル名/                 # 展開されたディレクトリ
│   ├── *.html                  # 展開されたファイル
│   └── images/                 # 関連ファイル
└── ファイル名.md               # 変換後のMarkdownファイル
```

#### 実例：AI面接システムSpeechToTextの結果
1. ZIPファイルを展開
2. HTMLファイルと画像ファイルを確認
3. 画像を_attachmentsに配置（ハッシュ付きファイル名）
4. HTMLをMarkdownに変換
5. 画像リンクをObsidian形式に更新

---

## 注意事項
- 大きなメディアファイルは、必要に応じて圧縮を検討
- 外部URLの画像は、可能な限りローカルにダウンロードして管理
- 日本語ファイル名は英数字に変更を推奨