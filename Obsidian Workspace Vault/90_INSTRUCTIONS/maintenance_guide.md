# 標準作業手順書（SOP）: Vaultメンテナンス

## 実行トリガー

以下の状況でこの手順書に従ってメンテナンスを実行します：
- 定期メンテナンス（推奨：週1回）
- 大量のファイル操作後
- リンクエラーが報告された時
- ファイル名の一括変更後

## このタスクにおけるあなたの役割

このタスクを実行する際、あなたは「Vault管理者」です。知識ベースの健全性を維持し、問題を早期に発見・修正することが目的です。

## ツールの場所

- **メンテナンスツール**: `90_INSTRUCTIONS/_maintenance/vault_health.py`
- **レポート保存先**: `90_INSTRUCTIONS/_maintenance/reports/`

## ステップごとの処理手順

### ステップ1: 健全性チェック

```bash
cd /Users/yuki/Workspace/obsidian/Obsidian Workspace Vault/90_INSTRUCTIONS/_maintenance
python vault_health.py check
```

このコマンドで以下をチェックします：
- Frontmatterの完全性（id、aliases）
- リンクの有効性
- IDとaliasesの一致

### ステップ2: 問題の評価

チェック結果を確認し、以下を判断します：

1. **軽微な問題**（自動修正可能）
   - aliasesの欠落
   - 単純なフォーマットエラー

2. **重大な問題**（手動対応必要）
   - 壊れたリンク
   - IDの欠落
   - ファイル構造の不整合

### ステップ3: 自動修正の実行

軽微な問題がある場合：

```bash
python vault_health.py fix
```

**重要**: 修正前に必ず確認プロンプトが表示されます。内容を確認してから実行してください。

### ステップ4: レポートの生成と保存

詳細なレポートが必要な場合：

```bash
python vault_health.py report
```

レポートは`reports/health_report_YYYYMMDD_HHMMSS.md`として保存されます。

### ステップ5: 手動修正（必要な場合）

自動修正できない問題については：

1. **壊れたリンク**
   - 正しいファイル名またはIDに更新
   - 削除されたファイルへのリンクは削除

2. **IDの問題**
   - 既存のIDスキームに従って手動で追加
   - 形式: `id_YYYYMMDD_descriptive_name`

## トラブルシューティング

### よくある問題と対処法

1. **大量のaliases欠落**
   - 原因：古いフォーマットのファイル
   - 対処：`fix`コマンドで一括修正

2. **リンクエラーの急増**
   - 原因：ファイル名の変更
   - 対処：aliasesが正しく設定されているか確認

3. **スクリプトエラー**
   - 原因：Pythonパスの問題
   - 対処：`python3`を明示的に使用

## 定期メンテナンスワークフロー

### 週次メンテナンス（推奨）

1. **金曜日の終業時**に実行
2. `check`でVault全体をスキャン
3. 軽微な問題は`fix`で修正
4. 重大な問題は翌週の課題として記録

### 月次レビュー

1. `report`で詳細レポート生成
2. レポートの傾向分析
3. 繰り返し発生する問題の根本対策検討

## ベストプラクティス

1. **予防的メンテナンス**
   - 問題が蓄積する前に定期実行
   - 大規模な変更後は必ず実行

2. **段階的な修正**
   - まず`check`で状況把握
   - 自動修正可能なものから対処
   - 手動修正は計画的に実施

3. **記録の保持**
   - 月次レポートは保管
   - 問題の傾向を把握

## 注意事項

- 修正前に必ずバックアップを確認
- 大量の修正が必要な場合は段階的に実施
- 不明な点があれば手動確認を優先